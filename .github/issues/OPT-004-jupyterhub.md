# OPT-004: JupyterHub

## Component Requirements

**Component**: JupyterHub  
**Type**: Optional  
**Priority**: Medium  
**Dependencies**: Keycloak, Harbor, MicroK8s  

## Description

Migrate JupyterHub deployment from thinkube-core to thinkube. JupyterHub provides multi-user Jupyter notebook environments for data science and development work.

## Requirements Analysis

Based on source playbooks analysis:

### Deployment Requirements
1. **Custom Image Build**:
   - Podman-based image building
   - Push to Harbor registry
   - Package management system
   - Rebuild scripts for maintenance
2. **Deployment via Helm**:
   - Namespace: `jupyterhub`
   - Helm chart from official repository
   - Custom values configuration
3. **Authentication**:
   - Keycloak OIDC integration
   - Role-based access control
4. **Storage**:
   - Dynamic PVC for user notebooks
   - Shared storage for common data

### Keycloak Integration
1. **Client Configuration**:
   - OIDC authentication
   - User profile mapping
   - Group-based authorization
2. **Role Mapping**:
   - Admin users
   - Regular users
   - Resource limits by role

### Custom Image Features
1. **Pre-installed Packages**:
   - Data science libraries
   - Custom extensions
   - Development tools
2. **User Environment**:
   - Persistent home directories
   - Shared notebooks
   - GPU support (if available)

## Migration Plan

### Phase 1: Image Building
1. Setup build environment: `ansible/40_thinkube/optional/jupyterhub/10_build_env.yaml`
2. Build custom image: `ansible/40_thinkube/optional/jupyterhub/20_build_image.yaml`
3. Push to Harbor: `ansible/40_thinkube/optional/jupyterhub/30_push_image.yaml`

### Phase 2: Keycloak Setup
1. Configure client: `ansible/40_thinkube/optional/jupyterhub/40_keycloak_client.yaml`
2. Setup roles: `ansible/40_thinkube/optional/jupyterhub/45_keycloak_roles.yaml`

### Phase 3: Deployment
1. Deploy via Helm: `ansible/40_thinkube/optional/jupyterhub/50_deploy_jupyterhub.yaml`
2. Configure ingress: `ansible/40_thinkube/optional/jupyterhub/60_ingress.yaml`

### Phase 4: Testing
1. Validate deployment: `ansible/40_thinkube/optional/jupyterhub/88_test_jupyterhub.yaml`

### Phase 5: Rollback
1. Create rollback: `ansible/40_thinkube/optional/jupyterhub/89_rollback_jupyterhub.yaml`

## Implementation Checklist

- [ ] Create directory structure
- [ ] Port image build process
- [ ] Configure Keycloak integration
- [ ] Deploy via Helm
- [ ] Setup persistent storage
- [ ] Configure ingress
- [ ] Test user access
- [ ] Document configuration

## Notes

- Custom image building uses Podman
- Harbor robot tokens required for push
- GPU support available if nodes have GPUs
- User storage persists across sessions

## Related Files

**Source Playbooks**:
- `services/100_jupyterhub_image_build.yaml`
- `services/101_setup_jupyterhub.yaml`

**Target Directory**: `ansible/40_thinkube/optional/jupyterhub/`

---
*Migration tracking for Thinkube platform - Generated by Analysis System*